import pandas as pd
import calc_money_index
import datetime

from sklearn.preprocessing import StandardScaler


def convertime(dateStr):
    return datetime.datetime.strptime(dateStr, '%Y-%m-%d')


type11_mean = [0.225770, 0.364424, 3.287546, -0.868776, 0.10219854, 0.72729152,
               0.10687063, 4.105034, -0.45369, 3.65841, -0.3920764, 230110.55,
               0.901324, 0.46535949, 0.7207136, 0.733647, 0.240906, 0.186421,
               0.0065723]
type11_std = [1.59755, 2.144301, 4.945692, 15.482291, 1.0547714, 0.934282268,
              0.52552796, 4.973998516, 10.75758773, 5.003096182, 20.98744121,
              394657.8113, 463.59952, 224.3206, 0.320946, 0.324234, 126.7493,
              111.80643, 0.079369]

type12_mean = [0.6293848, 0.6222469, 3.6840268, -0.7722980, 0.134316657,
               0.1184638, 0.07436005, 4.23552363, -0.51418787, 3.7689341,
               -0.47723781, 354887.48, 20.64166, 9.9396337, 0.6549147,
               0.6896193, 0.7440385, 0.21997813, 0.0061838]
type12_std = [2.70170, 2.880785, 5.442183, 33.35692, 1.2179863, 1.2071928,
              0.4383113, 5.3793884, 1.3741603, 5.3694802, 2.1151783,
              736218.049, 3726.2523, 1784.2517, 0.309478, 0.3230387, 226.56164,
              56.85439, 0.0775130]

type13_mean = [0.273282, 0.286480, 2.5802807, -0.9194813, 0.09192127,
               0.065220883, 0.0892349, 5.7058753, -0.347193, 5.0736713,
               -0.2845426, 149747.95, 0.3155858, 0.20407722, 0.666153462,
               0.68425187, 0.0720131, 0.05757150, 0.00765364]
type13_std = [1.721757, 1.8991419, 4.4201524, 6.8829284, 0.999940604,
              0.8683504, 0.4698074, 5.1117508, 3.442362, 5.3360793, 16.101665,
              243469.58, 111.98752, 61.23410, 0.324820, 0.3306980, 13.410709,
              12.296568, 0.0862664]

type21_mean = [0.08480146, 1.4765167, 4.2352920, -0.62904373, 0.45143550,
               0.2587988, 0.28591288, 5.1764780, -0.13035135, 4.7923059,
               0.1460343, 194417.00, 1.099175, 0.6756229, 0.6044088, 0.6497187,
               1.8820526, 1.6080443, 0.010795118]
type21_std = [3.09638, 4.20739, 5.05653, 12.0945, 2.21273, 1.79053, 0.870659,
              5.309238, 63.14411, 5.387533, 130.2939, 412482.3, 163.7207,
              142.3528, 0.35304, 0.376039, 419.572, 394.282, 0.100282]

type31_mean = [0.856584, 1.4111725, 0.7656215, 0.41980068, 0.0475478,
               0.03192960, 0.10020003, 1.98352519, -0.42960545, 1.707586536,
               -0.3823469, 25178.255, 0.24535694, 0.152746068, 0.69756086,
               0.7070907, 0.1038311, 0.0907598, 0.00813256]
type31_std = [2.64624, 2.989186, 2.185247, 11.76334, 0.709365, 0.58128,
              0.471733, 3.225695, 3.401401, 3.186857, 4.151679, 103762.2,
              35.78467, 11.3966, 0.410755, 0.413474, 17.82664, 17.59358,
              0.088462]

type41_mean = [1.62435312, 2.743487443, 4.279667047, -0.453105023, 0.522391553,
               0.445555556, 0.13185312, 2.022783486, -0.581484945, 1.847233638,
               -0.404776073, 142705.5982, 3.891717061, 2.714019992,
               0.792035325, 0.817413546, 2.044582697, 1.760833477, 0.003552849]
type41_std = [3.933937023, 5.091261354, 4.609581936, 7.105680319, 2.331494639,
              2.236794504, 0.609023839, 4.096652903, 47.42084645, 3.99806074,
              103.1098461, 451311.3564, 446.4438651, 335.8235882, 0.335764374,
              0.338698737, 787.8206377, 777.097339, 0.057680456]

type51_mean = [2.574806925, 3.620779537, 1.698536255, -0.248049647,
               3.929184727, 1.70598931, 0.039902383, 0.448605669, -0.894526599,
               0.398893032, -0.868249675, 37602.86185, 1.157865006,
               0.858348353, 0.899214366, 0.907429342, 0.92918007, 0.479020588,
               0.000725454]
type51_std = [4.429504566, 5.094725573, 2.769520289, 8.049035436, 5.024085882,
              3.784460778, 0.337672488, 1.951559072, 19.28344234, 2.851194042,
              40.61702601, 1226194.714, 159.3500638, 81.54698297, 0.258018768,
              0.256509663, 748.5494422, 256.916178, 0.025926797]

type81_mean = [-0.0495781532, -0.367402738, 0.402005689, -0.90375274,
               -0.548223139, -0.570333076, 0.384278683, 4.680695159,
               0.196819848, 4.311083109, 0.330683405, 67383.87476, 0.294625249,
               0.143576585, 0.222954967, 0.22770494, 0.096325243, 0.087861408,
               0.009949441]
type81_std = [1.453331707, 2.002304423, 3.415771005, 8.892428493, 1.190598216,
              1.095210068, 1.004824021, 3.361503753, 19.52608275, 3.512692786,
              42.94910539, 255389.0631, 290.2427897, 125.9229249, 0.382555452,
              0.389760399, 93.53716736, 91.41688679, 0.095165187]

type99_mean = [2.192397788, 3.741603683, 2.684753374, -0.165010466,
               0.902186827, 0.513155058, 0.104499646, 2.082629085,
               -0.660287498, 1.90933201, -0.579357829, 103909.9151, 1.76881053,
               1.033289716, 0.807994521, 0.823661585, 2.692104671, 1.228668013,
               0.003998405]
type99_std = [4.407746896, 5.508778705, 4.163781443, 22.55648692, 3.001318845,
              2.302314507, 0.539641956, 4.143447084, 29.67026229, 4.072769835,
              61.41249298, 337930.7371, 941.4843789, 470.220457, 0.335103942,
              0.336282378, 1418.721132, 568.0109827, 0.061251822]

fea_coef = [0.318, 0.129, 0.164, 0.00243, 0.237, 0.0207, 0.261, 0.0315,
            0.00405, 0.0509, -0.0369, 0.154, 0.0551, -0.0324, 1.204, 0.246,
            -0.157, 0.144, 0.884]


def transform_X(X_da, loantype):
    X = X_da
    scaler = StandardScaler()
    if loantype == 11:
        scaler.mean_ = type11_mean
        scaler.std_ = type11_std
    elif loantype == 12:
        scaler.mean_ = type12_mean
        scaler.std_ = type12_std
    elif loantype == 13:
        scaler.mean_ = type13_mean
        scaler.std_ = type13_std
    elif loantype == 21:
        scaler.mean_ = type21_mean
        scaler.std_ = type21_std
    elif loantype == 31:
        scaler.mean_ = type31_mean
        scaler.std_ = type31_std
    elif loantype == 41:
        scaler.mean_ = type41_mean
        scaler.std_ = type41_std
    elif loantype == 51:
        scaler.mean_ = type51_mean
        scaler.std_ = type51_std
    elif loantype == 81:
        scaler.mean_ = type81_mean
        scaler.std_ = type81_std
    elif loantype == 99:
        scaler.mean_ = type99_mean
        scaler.std_ = type99_std
    else:
        raise TypeError('loantype not support! loantype : ' + str(loantype))
    columns = X.columns
    X = scaler.transform(X)
    X = pd.DataFrame(X)
    X.columns = columns
    return X


def calc_X_coef(X_da, loantype):
    columns = X_da.columns
    X = transform_X(X_da, loantype)
    imp = []
    for i in range(len(fea_coef)):
        imp.append((columns[i], fea_coef[i] * X.iloc[0, i], fea_coef[i],
                    X.iloc[0, i]))
    return imp


def calc_X_new(X_data, loan, loancard, special):
    X_data = calc_money_index.calc_X_loanmoney(loan, X_data)
    X_data = calc_money_index.calc_X_special(special, X_data)
    X_data = calc_money_index.calc_X_51loan(loan, X_data)
    X_data = calc_money_index.calc_X_loancardmoney(loancard, X_data)
    X_data = calc_money_index.calc_X_loan(loan, X_data)
    X_data = calc_money_index.calc_X_loancard24(loancard, X_data)
    return X_data
